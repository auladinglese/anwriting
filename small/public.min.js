angular.module("underscoreFilter",[]).filter("unders",function(){return function(e){return e.replace(/ /g,"_")}});var app=angular.module("Grammarbuffet",["ngResource","ngRoute","monospaced.elastic","angular-growl","ngSanitize","underscoreFilter"]);app.config(["$routeProvider",function(e){e.when("/",{templateUrl:"partials/home.html",controller:"HomeCtrl"}).when("/fiction",{templateUrl:"partials/fiction.html",controller:"FictionCtrl"}).when("/fiction/easy/:id/:url",{templateUrl:"partials/easy-fiction-form.html",controller:"EasyFictionCtrl"}).when("/fiction/regular/:id/:url",{templateUrl:"partials/regular-fiction-form.html",controller:"RegularFictionCtrl"}).when("/academic",{templateUrl:"partials/academic.html",controller:"AcademicCtrl"}).when("/academic/easy/:summary",{templateUrl:"partials/easy-academic-form.html",controller:"EasyAcademicCtrl"}).when("/academic/regular/:summary",{templateUrl:"partials/regular-academic-form.html",controller:"RegularAcademicCtrl"}).when("/business",{templateUrl:"partials/business.html",controller:"BusinessCtrl"}).when("/business/easy/news/:url",{templateUrl:"partials/easy-business-form.html",controller:"EasyBusinessCtrl"}).when("/business/regular/news/:url",{templateUrl:"partials/regular-business-form.html",controller:"RegularBusinessCtrl"}).otherwise({redirectTo:"/"})}]),app.config(["growlProvider",function(e){e.globalTimeToLive(8e3),e.globalDisableCountDown(!0),e.globalPosition("bottom-right")}]),app.service("promptService",function(e){return e.get("https://www.reddit.com/r/writingprompts.json",{cache:!0})}),app.factory("StoryList",function(e){return e("/stories/:id/:url",{cache:!0})}),app.factory("AbstractList",function(e){return e("/abstracts/:searchTerm",{cache:!0})}),app.factory("ArticleList",function(e){return e("/articleList",{cache:!0})}),app.factory("Article",function(e){return e("/article/:url",{cache:!0})}),app.controller("HomeCtrl",["$scope","$resource","$location","StoryList","$sce",function(e,t,r,n,s){e.goToBusiness=function(){r.path("/business")},e.goToAcademic=function(){r.path("/academic")},e.goToFiction=function(){r.path("/fiction")}}]),app.controller("FictionCtrl",["$scope","$resource","promptService","$location",function(e,t,r,n){function s(e,t){var r=[];for(var n in e)e.hasOwnProperty(n)&&("object"==typeof e[n]?r=r.concat(s(e[n],t)):n==t&&r.push(e[n]));return r}e.placeholder=0,r.then(function(t){var r=t.data;e.placeholder=1;for(var n=s(r,"title"),i=s(r,"url"),o=n.filter(function(e){return e.indexOf("WP")>=0||e.indexOf("wp")>=0||e.indexOf("Wp")>=0?e:void 0}),a=i.filter(function(e){return e.indexOf("WP")>=0||e.indexOf("wp")>=0||e.indexOf("Wp")>=0?e:void 0}),l=a.map(function(e){return e.substring(49)}),c=[],u=0;u<o.length;u++)c.push([o[u],l[u]]);e.redditTitles=c}),e.formData={},e.formData.easyRegular="easy",e.goToHome=function(){n.path("/")}}]),app.controller("EasyFictionCtrl",["$scope","$location","$routeParams","growl","StoryList","$sce",function(e,t,r,n,s,i){r.id,r.url;e.story="LOADING STORY...",e.amendedStory="LOADING STORY...",s.get({id:r.id,url:r.url},function(t){e.story=t.story,e.story_highlights=t.story,e.amendedStory=t.story.replace(/ the /gi," *** ").replace(/ a /gi," *** ").replace(/ an /gi," *** ")}),e.check=function(){var t=e.story.toLowerCase().split(" "),r=e.amendedStory.toLowerCase().split(" ");console.log("the length of the original is "+t.length),console.log("the length of the amended is "+r.length);for(var s=0,i=0;i<t.length;i++)t[i]!==r[i]&&(s+=1);console.log(t),console.log(r),console.log("the final count of differences is "+s),angular.equals(e.story.toLowerCase(),e.amendedStory.toLowerCase())?n.success("SUCCESS!!!",{title:"Nice Work, you fixed all the errors!!!"}):s>5?n.warning("...not done yet",{title:"We're still missing "+s+" things"}):s>1?n.warning("...getting closer",{title:"We're still missing "+s+" things"}):n.warning("...you're almost there!!!",{title:"We're still missing "+s+" thing"})},e.goToStories=function(){t.path("/fiction")},e.getHint=function(){function t(e,t){for(var r=0;r<t.length;r++)e[t[r]]='<span class="hl">   </span>';console.log(e);var n=e.join(",");return n.replace(/,/g," ")}for(var r=e.story.toLowerCase().split(" "),s=e.amendedStory.toLowerCase().split(" "),i=0,o=0;o<r.length;o++)r[o]!==s[o]&&(i+=1);for(var a=[],o=0;o<r.length;o++)r[o]!==s[o]&&a.push(o);e.story_highlights=t(r,a),n.warning("...look near the RED marks",{title:"We're still missing "+i+" things"}),setTimeout(function(){e.story_highlights=e.story},8e3)},e.switchBool=function(t){e[t]=!e[t]}}]),app.controller("RegularFictionCtrl",["$scope","$resource","$location","$routeParams","growl","StoryList","$sce",function(e,t,r,n,s,i,o){n.id,n.url;e.story="LOADING STORY...",e.amendedStory="LOADING STORY...",i.get({id:n.id,url:n.url},function(t){e.story=t.story,e.amendedStory=t.story.replace(/ the /g," ").replace(/ a /g," ").replace(/ an /g," ").replace(/ The /g," ").replace(/ A /g," ").replace(/ An /g," "),e.story_highlights=t.story}),e.check=function(){function t(e){for(var t=0,r=0;r<e.length;r++)"a"!=e[r]&&"A"!=e[r]||t++;return t}function r(e){for(var t=0,r=0;r<e.length;r++)"an"!=e[r]&&"An"!=e[r]||t++;return t}function n(e){for(var t=0,r=0;r<e.length;r++)"the"!=e[r]&&"The"!=e[r]||t++;return t}var i=e.story.toLowerCase().split(" "),o=e.amendedStory.toLowerCase().split(" ");t(i)!==t(o)?t(i)>t(o)?s.warning("...OOPS!",{title:"We don't have enough A's"}):t(i)<t(o)&&s.warning("...OOPS!",{title:"We have too many A's"}):s.success("SUCCESS!!!",{title:"Nice Work, you added in all the A's!!!"}),r(i)!==r(o)?r(i)>r(o)?s.warning("...OOPS!",{title:"We don't have enough An's"}):r(i)<r(o)&&s.warning("...OOPS!",{title:"We have too many An's"}):s.success("SUCCESS!!!",{title:"Nice Work, you added in all the An's!!!"}),n(i)!==n(o)?n(i)>n(o)?s.warning("...OOPS!",{title:"We don't have enough The's"}):n(i)<n(o)&&s.warning("...OOPS!",{title:"We have too many The's"}):s.success("SUCCESS!!!",{title:"Nice Work, you added in all the The's!!!"})},e.goToStories=function(){r.path("/fiction")},e.getHint=function(){function t(e){for(var t=0,r=0;r<e.length;r++)"a"!=e[r]&&"A"!=e[r]||t++;return t}function r(e){for(var t=0,r=0;r<e.length;r++)"an"!=e[r]&&"An"!=e[r]||t++;return t}function n(e){for(var t=0,r=0;r<e.length;r++)"the"!=e[r]&&"The"!=e[r]||t++;return t}var i=e.story.toLowerCase().split(" "),o=e.amendedStory.toLowerCase().split(" ");s.warning("...look near the singular countable nouns",{title:"We have "+t(o)+" A's, and we need "+t(i)+"...we have "+r(o)+" An's, and we need "+r(i)+"...we have "+n(o)+" The's, and we need "+n(i)})}}]),app.controller("AcademicCtrl",["$scope","$resource","AbstractList","$routeParams","$location",function(e,t,r,n,s){e.text;e.formData={},e.getAbstracts=function(){r.get({searchTerm:e.formData.text},function(t){var r=t.feed.entry;e.abstracts=r})},e.formData.easyRegular="easy",e.goToHome=function(){s.path("/")}}]),app.controller("EasyAcademicCtrl",["$scope","$location","$routeParams","growl","$sce",function(e,t,r,n,s){var i=r.summary.replace(/_/g," ");i=i.trimLeft(),e.summary=i,e.amendedSummary=i.replace(/ the /gi," *** ").replace(/ a /gi," *** ").replace(/ an /gi," *** "),e.summary_highlights=i,e.check=function(){for(var t=e.summary.toLowerCase().split(" "),r=e.amendedSummary.toLowerCase().split(" "),s=0,i=0;i<t.length;i++)t[i]!==r[i]&&(s+=1);console.log("the final count of differences is "+s),angular.equals(e.summary.toLowerCase(),e.amendedSummary.toLowerCase())?n.success("SUCCESS!!!",{title:"Nice Work, you fixed all the errors!!!"}):s>5?n.warning("...not done yet",{title:"We're still missing "+s+" things"}):s>1?n.warning("...getting closer",{title:"We're still missing "+s+" things"}):n.warning("...you're almost there!!!",{title:"We're still missing "+s+" thing"})},e.goToTitles=function(){t.path("/academic")},e.getHint=function(){function t(e,t){for(var r=0;r<t.length;r++)e[t[r]]='<span class="hl">   </span>';console.log(e);var n=e.join(",");return n.replace(/,/g," ")}for(var r=e.summary.toLowerCase().split(" "),s=e.amendedSummary.toLowerCase().split(" "),i=0,o=0;o<r.length;o++)r[o]!==s[o]&&(i+=1);for(var a=[],o=0;o<r.length;o++)r[o]!==s[o]&&a.push(o);e.summary_highlights=t(r,a),n.warning("...look near the red marks",{title:"We're still missing "+i+" things"}),setTimeout(function(){e.summary_highlights=e.summary},8e3)}}]),app.controller("RegularAcademicCtrl",["$scope","$resource","$location","$routeParams","growl","$sce",function(e,t,r,n,s,i){var o=n.summary.replace(/_/g," ");o=o.trimLeft(),e.summary=o,e.amendedSummary=o.replace(/ the /gi," ").replace(/ a /gi," ").replace(/ an /gi," ").replace(/ The /gi," ").replace(/ A /gi," ").replace(/ An /gi," "),e.summary_highlights=o,e.check=function(){function t(e){for(var t=0,r=0;r<e.length;r++)"a"!=e[r]&&"A"!=e[r]||t++;return t}function r(e){for(var t=0,r=0;r<e.length;r++)"an"!=e[r]&&"An"!=e[r]||t++;return t}function n(e){for(var t=0,r=0;r<e.length;r++)"the"!=e[r]&&"The"!=e[r]||t++;return t}var i=e.summary.toLowerCase().split(" "),o=e.amendedSummary.toLowerCase().split(" ");t(i)!==t(o)?t(i)>t(o)?s.warning("...OOPS!",{title:"We don't have enough A's"}):t(i)<t(o)&&s.warning("...OOPS!",{title:"We have too many A's"}):s.success("SUCCESS!!!",{title:"Nice Work, you added in all the A's!!!"}),r(i)!==r(o)?r(i)>r(o)?s.warning("...OOPS!",{title:"We don't have enough An's"}):r(i)<r(o)&&s.warning("...OOPS!",{title:"We have too many An's"}):s.success("SUCCESS!!!",{title:"Nice Work, you added in all the An's!!!"}),n(i)!==n(o)?n(i)>n(o)?s.warning("...OOPS!",{title:"We don't have enough The's"}):n(i)<n(o)&&s.warning("...OOPS!",{title:"We have too many The's"}):s.success("SUCCESS!!!",{title:"Nice Work, you added in all the The's!!!"})},e.goToTitles=function(){r.path("/academic")},e.getHint=function(){function t(e){for(var t=0,r=0;r<e.length;r++)"a"!=e[r]&&"A"!=e[r]||t++;return t}function r(e){for(var t=0,r=0;r<e.length;r++)"an"!=e[r]&&"An"!=e[r]||t++;return t}function n(e){for(var t=0,r=0;r<e.length;r++)"the"!=e[r]&&"The"!=e[r]||t++;return t}var i=e.summary.toLowerCase().split(" "),o=e.amendedSummary.toLowerCase().split(" ");s.warning("...look near the singular countable nouns",{title:"We have "+t(o)+" A's, and we need "+t(i)+"...we have "+r(o)+" An's, and we need "+r(i)+"...we have "+n(o)+" The's, and we need "+n(i)})}}]),app.controller("BusinessCtrl",["$scope","$resource","ArticleList","$location",function(e,t,r,n){r.query(function(t){var r=t;e.articles=r}),e.placeholder=1,e.formData={},e.formData.easyRegular="easy",e.goToHome=function(){n.path("/")}}]),app.controller("EasyBusinessCtrl",["$scope","$location","$routeParams","growl","Article","$sce",function(e,t,r,n,s,i){r.url;e.amendedArticle="LOADING STORY...",s.get({url:r.url},function(t){var r=t.response;e.article=r,e.amendedArticle=r.replace(/ the /gi," *** ").replace(/ a /gi," *** ").replace(/ an /gi," *** "),e.article_highlights=r}),e.check=function(){for(var t=e.article.toLowerCase().split(" "),r=e.amendedArticle.toLowerCase().split(" "),s=0,i=0;i<t.length;i++)t[i]!==r[i]&&(s+=1);console.log("the final count of differences is "+s),angular.equals(e.article.toLowerCase(),e.amendedArticle.toLowerCase())?n.success("SUCCESS!!!",{title:"Nice Work, you fixed all the errors!!!"}):s>5?n.warning("...not done yet",{title:"We're still missing "+s+" things"}):s>1?n.warning("...getting closer",{title:"We're still missing "+s+" things"}):n.warning("...you're almost there!!!",{title:"We're still missing "+s+" thing"})},e.goToHeadlines=function(){t.path("/business")},e.getHint=function(){function t(e,t){for(var r=0;r<t.length;r++)e[t[r]]='<span class="hl">   </span>';console.log(e);var n=e.join(",");return n.replace(/,/g," ")}for(var r=e.article.toLowerCase().split(" "),s=e.amendedArticle.toLowerCase().split(" "),i=0,o=0;o<r.length;o++)r[o]!==s[o]&&(i+=1);for(var a=[],o=0;o<r.length;o++)r[o]!==s[o]&&a.push(o);e.article_highlights=t(r,a),n.warning("...look near the red marks",{title:"We're still missing "+i+" things"}),setTimeout(function(){e.article_highlights=e.article},8e3)}}]),app.controller("RegularBusinessCtrl",["$scope","$resource","$location","$routeParams","growl","Article","$sce",function(e,t,r,n,s,i,o){n.url;e.amendedArticle="LOADING STORY...",i.get({url:n.url},function(t){var r=t.response;e.article=r,e.amendedArticle=r.replace(/ the /gi," ").replace(/ a /gi," ").replace(/ an /gi," ").replace(/ The /gi," ").replace(/ A /gi," ").replace(/ An /gi," "),e.article_highlights=r}),e.check=function(){function t(e){for(var t=0,r=0;r<e.length;r++)"a"!=e[r]&&"A"!=e[r]||t++;return t}function r(e){for(var t=0,r=0;r<e.length;r++)"an"!=e[r]&&"An"!=e[r]||t++;return t}function n(e){for(var t=0,r=0;r<e.length;r++)"the"!=e[r]&&"The"!=e[r]||t++;return t}var i=e.article.toLowerCase().split(" "),o=e.amendedArticle.toLowerCase().split(" ");t(i)!==t(o)?t(i)>t(o)?s.warning("...OOPS!",{title:"We don't have enough A's"}):t(i)<t(o)&&s.warning("...OOPS!",{title:"We have too many A's"}):s.success("SUCCESS!!!",{title:"Nice Work, you added in all the A's!!!"}),r(i)!==r(o)?r(i)>r(o)?s.warning("...OOPS!",{title:"We don't have enough An's"}):r(i)<r(o)&&s.warning("...OOPS!",{title:"We have too many An's"}):s.success("SUCCESS!!!",{title:"Nice Work, you added in all the An's!!!"}),n(i)!==n(o)?n(i)>n(o)?s.warning("...OOPS!",{title:"We don't have enough The's"}):n(i)<n(o)&&s.warning("...OOPS!",{title:"We have too many The's"}):s.success("SUCCESS!!!",{title:"Nice Work, you added in all the The's!!!"})},e.goToHeadlines=function(){r.path("/business")},e.getHint=function(){function t(e){for(var t=0,r=0;r<e.length;r++)"a"!=e[r]&&"A"!=e[r]||t++;return t}function r(e){for(var t=0,r=0;r<e.length;r++)"an"!=e[r]&&"An"!=e[r]||t++;return t}function n(e){for(var t=0,r=0;r<e.length;r++)"the"!=e[r]&&"The"!=e[r]||t++;return t}var i=e.article.toLowerCase().split(" "),o=e.amendedArticle.toLowerCase().split(" ");s.warning("...look near the singular countable nouns",{title:"We have "+t(o)+" A's, and we need "+t(i)+"...we have "+r(o)+" An's, and we need "+r(i)+"...we have "+n(o)+" The's, and we need "+n(i)})}}]),angular.module("angular-growl",[]),angular.module("angular-growl").directive("growl",[function(){"use strict";return{restrict:"A",templateUrl:"templates/growl/growl.html",replace:!1,scope:{reference:"@",inline:"=",limitMessages:"="},controller:["$scope","$interval","growl","growlMessages",function(e,t,r,n){e.referenceId=e.reference||0,n.initDirective(e.referenceId,e.limitMessages),e.growlMessages=n,e.inlineMessage=angular.isDefined(e.inline)?e.inline:r.inlineMessages(),e.$watch("limitMessages",function(t){var r=n.directives[e.referenceId];angular.isUndefined(t)||angular.isUndefined(r)||(r.limitMessages=t)}),e.stopTimeoutClose=function(e){e.clickToClose||(angular.forEach(e.promises,function(e){t.cancel(e)}),e.close?n.deleteMessage(e):e.close=!0)},e.alertClasses=function(e){return{"alert-success":"success"===e.severity,"alert-error":"error"===e.severity,"alert-danger":"error"===e.severity,"alert-info":"info"===e.severity,"alert-warning":"warning"===e.severity,icon:e.disableIcons===!1,"alert-dismissable":!e.disableCloseButton}},e.showCountDown=function(e){return!e.disableCountDown&&e.ttl>0},e.wrapperClasses=function(){var t={};return t["growl-fixed"]=!e.inlineMessage,t[r.position()]=!0,t},e.computeTitle=function(e){var t={success:"Success",error:"Error",info:"Information",warn:"Warning"};return t[e.severity]}}]}}]),angular.module("angular-growl").run(["$templateCache",function(e){"use strict";void 0===e.get("templates/growl/growl.html")&&e.put("templates/growl/growl.html",'<div class="growl-container" ng-class="wrapperClasses()"><div class="growl-item alert" ng-repeat="message in growlMessages.directives[referenceId].messages" ng-class="alertClasses(message)" ng-click="stopTimeoutClose(message)"><button type="button" class="close" data-dismiss="alert" aria-hidden="true" ng-click="growlMessages.deleteMessage(message)" ng-show="!message.disableCloseButton">&times;</button><button type="button" class="close" aria-hidden="true" ng-show="showCountDown(message)">{{message.countdown}}</button><h4 class="growl-title" ng-show="message.title" ng-bind="message.title"></h4><div class="growl-message" ng-bind-html="message.text"></div></div></div>')}]),angular.module("angular-growl").provider("growl",function(){"use strict";var e={success:null,error:null,warning:null,info:null},t="messages",r="text",n="title",s="severity",i="ttl",o=!0,a="variables",l=0,c=!1,u="top-right",g=!1,h=!1,d=!1,f=!1,m=!0;this.globalTimeToLive=function(t){if("object"==typeof t)for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);else for(var n in e)e.hasOwnProperty(n)&&(e[n]=t);return this},this.globalTranslateMessages=function(e){return m=e,this},this.globalDisableCloseButton=function(e){return g=e,this},this.globalDisableIcons=function(e){return h=e,this},this.globalReversedOrder=function(e){return d=e,this},this.globalDisableCountDown=function(e){return f=e,this},this.messageVariableKey=function(e){return a=e,this},this.globalInlineMessages=function(e){return c=e,this},this.globalPosition=function(e){return u=e,this},this.messagesKey=function(e){return t=e,this},this.messageTextKey=function(e){return r=e,this},this.messageTitleKey=function(e){return n=e,this},this.messageSeverityKey=function(e){return s=e,this},this.messageTTLKey=function(e){return i=e,this},this.onlyUniqueMessages=function(e){return o=e,this},this.serverMessagesInterceptor=["$q","growl",function(e,r){function n(e){void 0!==e&&e.data&&e.data[t]&&e.data[t].length>0&&r.addServerMessages(e.data[t])}return{response:function(e){return n(e),e},responseError:function(t){return n(t),e.reject(t)}}}],this.$get=["$rootScope","$interpolate","$sce","$filter","$interval","growlMessages",function(t,p,w,v,y,C){function S(e){if(U&&e.translateMessage)e.text=U(e.text,e.variables)||e.text,e.title=U(e.title)||e.title;else{var r=p(e.text);e.text=r(e.variables)}var n=C.addMessage(e);return t.$broadcast("growlMessage",e),y(function(){},0,1),n}function A(t,r,n){var s,i=r||{};return s={text:t,title:i.title,severity:n,ttl:i.ttl||e[n],variables:i.variables||{},disableCloseButton:void 0===i.disableCloseButton?g:i.disableCloseButton,disableIcons:void 0===i.disableIcons?h:i.disableIcons,disableCountDown:void 0===i.disableCountDown?f:i.disableCountDown,position:i.position||u,referenceId:i.referenceId||l,translateMessage:void 0===i.translateMessage?m:i.translateMessage,destroy:function(){C.deleteMessage(s)},setText:function(e){s.text=w.trustAsHtml(String(e))},onclose:i.onclose,onopen:i.onopen},S(s)}function b(e,t){return A(e,t,"warning")}function T(e,t){return A(e,t,"error")}function O(e,t){return A(e,t,"info")}function $(e,t){return A(e,t,"success")}function L(e,t,r){return r=(r||"error").toLowerCase(),A(e,t,r)}function W(e){if(e&&e.length){var t,o,l,c;for(c=e.length,t=0;c>t;t++)if(o=e[t],o[r]){l=(o[s]||"error").toLowerCase();var u={};u.variables=o[a]||{},u.title=o[n],o[i]&&(u.ttl=o[i]),A(o[r],u,l)}}}function M(){return o}function P(){return d}function k(){return c}function D(){return u}var U;C.onlyUnique=o,C.reverseOrder=d;try{U=v("translate")}catch(x){}return{warning:b,error:T,info:O,success:$,general:L,addServerMessages:W,onlyUnique:M,reverseOrder:P,inlineMessages:k,position:D}}]}),angular.module("angular-growl").service("growlMessages",["$sce","$interval",function(e,t){"use strict";function r(e){var t;return t=i[e]?i[e]:i[e]={messages:[]}}function n(e){var t=e||0;return s.directives[t]||i[t]}var s=this;this.directives={};var i={};this.initDirective=function(e,t){return i[e]?(this.directives[e]=i[e],this.directives[e].limitMessages=t):this.directives[e]={messages:[],limitMessages:t},this.directives[e]},this.getAllMessages=function(e){e=e||0;var t;return t=n(e)?n(e).messages:[]},this.destroyAllMessages=function(e){for(var t=this.getAllMessages(e),r=t.length-1;r>=0;r--)t[r].destroy();var s=n(e);s&&(s.messages=[])},this.addMessage=function(n){var s,i,o,a;if(s=this.directives[n.referenceId]?this.directives[n.referenceId]:r(n.referenceId),i=s.messages,!this.onlyUnique||(angular.forEach(i,function(t){a=e.getTrustedHtml(t.text),n.text===a&&n.severity===t.severity&&n.title===t.title&&(o=!0)}),!o)){if(n.text=e.trustAsHtml(String(n.text)),n.ttl&&-1!==n.ttl&&(n.countdown=n.ttl/1e3,n.promises=[],n.close=!1,n.countdownFunction=function(){n.countdown>1?(n.countdown--,n.promises.push(t(n.countdownFunction,1e3,1,1))):n.countdown--}),angular.isDefined(s.limitMessages)){var l=i.length-(s.limitMessages-1);l>0&&i.splice(s.limitMessages-1,l)}if(this.reverseOrder?i.unshift(n):i.push(n),"function"==typeof n.onopen&&n.onopen(),n.ttl&&-1!==n.ttl){var c=this;n.promises.push(t(angular.bind(this,function(){c.deleteMessage(n)}),n.ttl,1,1)),n.promises.push(t(n.countdownFunction,1e3,1,1))}return n}},this.deleteMessage=function(e){var t=this.getAllMessages(e.referenceId),r=-1;for(var n in t)t.hasOwnProperty(n)&&(r=t[n]===e?n:r);r>-1&&(t[r].close=!0,t.splice(r,1)),"function"==typeof e.onclose&&e.onclose()}}]);